OfferingApiTest.test_api_offering_read_detail_with_accesses:
- db: 'SELECT DISTINCT ... FROM "joanie_course_product_relation" INNER JOIN "joanie_course_product_relation_organizations" ON ("joanie_course_product_relation"."id" = "joanie_course_product_relation_organizations"."courseproductrelation_id") INNER JOIN "joanie_course" ON ("joanie_course_product_relation"."course_id" = "joanie_course"."id") INNER JOIN "joanie_course_access" ON ("joanie_course"."id" = "joanie_course_access"."course_id") INNER JOIN "joanie_user" ON ("joanie_course_access"."user_id" = "joanie_user"."id") INNER JOIN "joanie_product" ON ("joanie_course_product_relation"."product_id" = "joanie_product"."id") LEFT OUTER JOIN "joanie_certificate_definition" ON ("joanie_product"."certificate_definition_id" = "joanie_certificate_definition"."id") LEFT OUTER JOIN "joanie_contract_definition" ON ("joanie_product"."contract_definition_id" = "joanie_contract_definition"."id") WHERE ("joanie_course_product_relation_organizations"."organization_id" IS NOT NULL AND "joanie_user"."username" = # AND "joanie_course_product_relation"."id" = #::uuid) LIMIT #'
- db: SELECT ... FROM "joanie_organization" INNER JOIN "joanie_course_product_relation_organizations" ON ("joanie_organization"."id" = "joanie_course_product_relation_organizations"."organization_id") WHERE "joanie_course_product_relation_organizations"."courseproductrelation_id" IN (#::uuid) ORDER BY "joanie_organization"."created_on" DESC
- db: SELECT ... FROM "joanie_offeringrule" INNER JOIN "joanie_course_product_relation" ON ("joanie_offeringrule"."course_product_relation_id" = "joanie_course_product_relation"."id") WHERE ("joanie_offeringrule"."is_active" AND "joanie_offeringrule"."course_product_relation_id" IN (#::uuid)) ORDER BY "joanie_course_product_relation"."created_on" DESC, "joanie_offeringrule"."position" ASC
- cache|get: parler.core.CourseTranslation.#.en-us
- cache|get: parler.core.OrganizationTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_address" WHERE ("joanie_address"."organization_id" = #::uuid AND "joanie_address"."is_main" AND "joanie_address"."is_reusable") ORDER BY "joanie_address"."created_on" DESC LIMIT #'
- cache|get: parler.core.ProductTranslation.#.en-us
- cache|get: parler.core.CertificateDefinitionTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_quote_definition" WHERE "joanie_quote_definition"."id" = #::uuid LIMIT #'
- cache|get: parler.core.QuoteDefinitionTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_course_run" LEFT OUTER JOIN "joanie_product_target_course_relation_course_runs" ON ("joanie_course_run"."id" = "joanie_product_target_course_relation_course_runs"."courserun_id") WHERE ("joanie_product_target_course_relation_course_runs"."producttargetcourserelation_id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) OR "joanie_course_run"."course_id" IN (SELECT W0."id" FROM "joanie_course" W0 INNER JOIN "joanie_product_target_course_relation" W1 ON (W0."id" = W1."course_id") WHERE (W1."product_id" = #::uuid AND NOT (EXISTS(SELECT # AS "a" FROM "joanie_product_target_course_relation" V1 WHERE (V1."id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) AND V1."id" = (W1."id") AND W1."course_id" = (W0."id")) LIMIT #)))))'
- db: 'SELECT ... FROM "joanie_product_target_course_relation" INNER JOIN "joanie_course" ON ("joanie_product_target_course_relation"."course_id" = "joanie_course"."id") WHERE "joanie_product_target_course_relation"."product_id" = #::uuid ORDER BY "joanie_product_target_course_relation"."position" ASC, "joanie_course"."code" ASC'
- db: 'SELECT ... FROM "joanie_course_run" LEFT OUTER JOIN "joanie_product_target_course_relation_course_runs" ON ("joanie_course_run"."id" = "joanie_product_target_course_relation_course_runs"."courserun_id") WHERE (("joanie_product_target_course_relation_course_runs"."producttargetcourserelation_id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) OR "joanie_course_run"."course_id" IN (SELECT W0."id" FROM "joanie_course" W0 INNER JOIN "joanie_product_target_course_relation" W1 ON (W0."id" = W1."course_id") WHERE (W1."product_id" = #::uuid AND NOT (EXISTS(SELECT # AS "a" FROM "joanie_product_target_course_relation" V1 WHERE (V1."id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) AND V1."id" = (W1."id") AND W1."course_id" = (W0."id")) LIMIT #))))) AND "joanie_course_run"."end" > #::timestamptz)'
- db: 'SELECT ... FROM "joanie_offeringrule" INNER JOIN "joanie_course_product_relation" ON ("joanie_offeringrule"."course_product_relation_id" = "joanie_course_product_relation"."id") WHERE ("joanie_offeringrule"."is_active" AND "joanie_offeringrule"."course_product_relation_id" = #::uuid AND "joanie_offeringrule"."is_active") ORDER BY "joanie_course_product_relation"."created_on" DESC, "joanie_offeringrule"."position" ASC'
OfferingApiTest.test_api_offering_read_detail_with_accesses.2:
- db: 'SELECT DISTINCT ... FROM "joanie_course_product_relation" INNER JOIN "joanie_course_product_relation_organizations" ON ("joanie_course_product_relation"."id" = "joanie_course_product_relation_organizations"."courseproductrelation_id") INNER JOIN "joanie_course" ON ("joanie_course_product_relation"."course_id" = "joanie_course"."id") INNER JOIN "joanie_course_access" ON ("joanie_course"."id" = "joanie_course_access"."course_id") INNER JOIN "joanie_user" ON ("joanie_course_access"."user_id" = "joanie_user"."id") INNER JOIN "joanie_product" ON ("joanie_course_product_relation"."product_id" = "joanie_product"."id") LEFT OUTER JOIN "joanie_certificate_definition" ON ("joanie_product"."certificate_definition_id" = "joanie_certificate_definition"."id") LEFT OUTER JOIN "joanie_contract_definition" ON ("joanie_product"."contract_definition_id" = "joanie_contract_definition"."id") WHERE ("joanie_course_product_relation_organizations"."organization_id" IS NOT NULL AND "joanie_user"."username" = # AND "joanie_course_product_relation"."id" = #::uuid) LIMIT #'
- db: SELECT ... FROM "joanie_organization" INNER JOIN "joanie_course_product_relation_organizations" ON ("joanie_organization"."id" = "joanie_course_product_relation_organizations"."organization_id") WHERE "joanie_course_product_relation_organizations"."courseproductrelation_id" IN (#::uuid) ORDER BY "joanie_organization"."created_on" DESC
- db: SELECT ... FROM "joanie_offeringrule" INNER JOIN "joanie_course_product_relation" ON ("joanie_offeringrule"."course_product_relation_id" = "joanie_course_product_relation"."id") WHERE ("joanie_offeringrule"."is_active" AND "joanie_offeringrule"."course_product_relation_id" IN (#::uuid)) ORDER BY "joanie_course_product_relation"."created_on" DESC, "joanie_offeringrule"."position" ASC
- cache|get: parler.core.CourseTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_course_translation" WHERE ("joanie_course_translation"."master_id" = #::uuid AND "joanie_course_translation"."language_code" = #) LIMIT #'
- cache|set: parler.core.CourseTranslation.#.en-us
- cache|get: parler.core.OrganizationTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_organization_translation" WHERE ("joanie_organization_translation"."master_id" = #::uuid AND "joanie_organization_translation"."language_code" = #) LIMIT #'
- cache|set: parler.core.OrganizationTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_address" WHERE ("joanie_address"."organization_id" = #::uuid AND "joanie_address"."is_main" AND "joanie_address"."is_reusable") ORDER BY "joanie_address"."created_on" DESC LIMIT #'
- cache|get: parler.core.ProductTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_product_translation" WHERE ("joanie_product_translation"."master_id" = #::uuid AND "joanie_product_translation"."language_code" = #) LIMIT #'
- cache|set: parler.core.ProductTranslation.#.en-us
- cache|get: parler.core.CertificateDefinitionTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_certificate_definition_translation" WHERE ("joanie_certificate_definition_translation"."master_id" = #::uuid AND "joanie_certificate_definition_translation"."language_code" = #) LIMIT #'
- cache|set: parler.core.CertificateDefinitionTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_quote_definition" WHERE "joanie_quote_definition"."id" = #::uuid LIMIT #'
- cache|get: parler.core.QuoteDefinitionTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_quote_definition_translation" WHERE ("joanie_quote_definition_translation"."master_id" = #::uuid AND "joanie_quote_definition_translation"."language_code" = #) LIMIT #'
- cache|set: parler.core.QuoteDefinitionTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_course_run" LEFT OUTER JOIN "joanie_product_target_course_relation_course_runs" ON ("joanie_course_run"."id" = "joanie_product_target_course_relation_course_runs"."courserun_id") WHERE ("joanie_product_target_course_relation_course_runs"."producttargetcourserelation_id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) OR "joanie_course_run"."course_id" IN (SELECT W0."id" FROM "joanie_course" W0 INNER JOIN "joanie_product_target_course_relation" W1 ON (W0."id" = W1."course_id") WHERE (W1."product_id" = #::uuid AND NOT (EXISTS(SELECT # AS "a" FROM "joanie_product_target_course_relation" V1 WHERE (V1."id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) AND V1."id" = (W1."id") AND W1."course_id" = (W0."id")) LIMIT #)))))'
- db: 'SELECT ... FROM "joanie_product_target_course_relation" INNER JOIN "joanie_course" ON ("joanie_product_target_course_relation"."course_id" = "joanie_course"."id") WHERE "joanie_product_target_course_relation"."product_id" = #::uuid ORDER BY "joanie_product_target_course_relation"."position" ASC, "joanie_course"."code" ASC'
- db: 'SELECT ... FROM "joanie_course_run" LEFT OUTER JOIN "joanie_product_target_course_relation_course_runs" ON ("joanie_course_run"."id" = "joanie_product_target_course_relation_course_runs"."courserun_id") WHERE (("joanie_product_target_course_relation_course_runs"."producttargetcourserelation_id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) OR "joanie_course_run"."course_id" IN (SELECT W0."id" FROM "joanie_course" W0 INNER JOIN "joanie_product_target_course_relation" W1 ON (W0."id" = W1."course_id") WHERE (W1."product_id" = #::uuid AND NOT (EXISTS(SELECT # AS "a" FROM "joanie_product_target_course_relation" V1 WHERE (V1."id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) AND V1."id" = (W1."id") AND W1."course_id" = (W0."id")) LIMIT #))))) AND "joanie_course_run"."end" > #::timestamptz)'
- db: 'SELECT ... FROM "joanie_offeringrule" INNER JOIN "joanie_course_product_relation" ON ("joanie_offeringrule"."course_product_relation_id" = "joanie_course_product_relation"."id") WHERE ("joanie_offeringrule"."is_active" AND "joanie_offeringrule"."course_product_relation_id" = #::uuid AND "joanie_offeringrule"."is_active") ORDER BY "joanie_course_product_relation"."created_on" DESC, "joanie_offeringrule"."position" ASC'
OfferingApiTest.test_api_offering_read_detail_with_product_id_anonymous:
- db: 'SELECT DISTINCT ... FROM "joanie_course_product_relation" INNER JOIN "joanie_course_product_relation_organizations" ON ("joanie_course_product_relation"."id" = "joanie_course_product_relation_organizations"."courseproductrelation_id") INNER JOIN "joanie_course" ON ("joanie_course_product_relation"."course_id" = "joanie_course"."id") INNER JOIN "joanie_product" ON ("joanie_course_product_relation"."product_id" = "joanie_product"."id") LEFT OUTER JOIN "joanie_certificate_definition" ON ("joanie_product"."certificate_definition_id" = "joanie_certificate_definition"."id") LEFT OUTER JOIN "joanie_contract_definition" ON ("joanie_product"."contract_definition_id" = "joanie_contract_definition"."id") WHERE ("joanie_course_product_relation_organizations"."organization_id" IS NOT NULL AND UPPER("joanie_course"."code"::text) = UPPER(#) AND UPPER("joanie_course"."code"::text) = UPPER(#) AND "joanie_course_product_relation"."product_id" = #::uuid) LIMIT #'
- db: SELECT ... FROM "joanie_organization" INNER JOIN "joanie_course_product_relation_organizations" ON ("joanie_organization"."id" = "joanie_course_product_relation_organizations"."organization_id") WHERE "joanie_course_product_relation_organizations"."courseproductrelation_id" IN (#::uuid) ORDER BY "joanie_organization"."created_on" DESC
- db: SELECT ... FROM "joanie_offeringrule" INNER JOIN "joanie_course_product_relation" ON ("joanie_offeringrule"."course_product_relation_id" = "joanie_course_product_relation"."id") WHERE ("joanie_offeringrule"."is_active" AND "joanie_offeringrule"."course_product_relation_id" IN (#::uuid)) ORDER BY "joanie_course_product_relation"."created_on" DESC, "joanie_offeringrule"."position" ASC
- db: 'SELECT ... FROM "easy_thumbnails_source" WHERE ("easy_thumbnails_source"."name" = # AND "easy_thumbnails_source"."storage_hash" = #) LIMIT #'
- db: 'UPDATE "easy_thumbnails_source" SET ... WHERE "easy_thumbnails_source"."id" = #'
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- cache|get: parler.core.CourseTranslation.#.en-us
- db: 'SELECT ... FROM "easy_thumbnails_source" WHERE ("easy_thumbnails_source"."name" = # AND "easy_thumbnails_source"."storage_hash" = #) LIMIT #'
- db: 'UPDATE "easy_thumbnails_source" SET ... WHERE "easy_thumbnails_source"."id" = #'
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- cache|get: parler.core.OrganizationTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_address" WHERE ("joanie_address"."organization_id" = #::uuid AND "joanie_address"."is_main" AND "joanie_address"."is_reusable") ORDER BY "joanie_address"."created_on" DESC LIMIT #'
- db: 'SELECT ... FROM "easy_thumbnails_source" WHERE ("easy_thumbnails_source"."name" = # AND "easy_thumbnails_source"."storage_hash" = #) LIMIT #'
- db: 'UPDATE "easy_thumbnails_source" SET ... WHERE "easy_thumbnails_source"."id" = #'
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- cache|get: parler.core.OrganizationTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_address" WHERE ("joanie_address"."organization_id" = #::uuid AND "joanie_address"."is_main" AND "joanie_address"."is_reusable") ORDER BY "joanie_address"."created_on" DESC LIMIT #'
- cache|get: parler.core.ProductTranslation.#.en-us
- cache|get: parler.core.CertificateDefinitionTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_course_run" LEFT OUTER JOIN "joanie_product_target_course_relation_course_runs" ON ("joanie_course_run"."id" = "joanie_product_target_course_relation_course_runs"."courserun_id") WHERE ("joanie_product_target_course_relation_course_runs"."producttargetcourserelation_id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) OR "joanie_course_run"."course_id" IN (SELECT W0."id" FROM "joanie_course" W0 INNER JOIN "joanie_product_target_course_relation" W1 ON (W0."id" = W1."course_id") WHERE (W1."product_id" = #::uuid AND NOT (EXISTS(SELECT # AS "a" FROM "joanie_product_target_course_relation" V1 WHERE (V1."id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) AND V1."id" = (W1."id") AND W1."course_id" = (W0."id")) LIMIT #)))))'
- db: 'SELECT ... FROM "joanie_product_target_course_relation" INNER JOIN "joanie_course" ON ("joanie_product_target_course_relation"."course_id" = "joanie_course"."id") WHERE "joanie_product_target_course_relation"."product_id" = #::uuid ORDER BY "joanie_product_target_course_relation"."position" ASC, "joanie_course"."code" ASC'
- db: 'SELECT ... FROM "joanie_course" WHERE "joanie_course"."id" = #::uuid LIMIT #'
- db: 'SELECT ... FROM "joanie_course_run" LEFT OUTER JOIN "joanie_product_target_course_relation_course_runs" ON ("joanie_course_run"."id" = "joanie_product_target_course_relation_course_runs"."courserun_id") WHERE (("joanie_product_target_course_relation_course_runs"."producttargetcourserelation_id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) OR "joanie_course_run"."course_id" IN (SELECT W0."id" FROM "joanie_course" W0 INNER JOIN "joanie_product_target_course_relation" W1 ON (W0."id" = W1."course_id") WHERE (W1."product_id" = #::uuid AND NOT (EXISTS(SELECT # AS "a" FROM "joanie_product_target_course_relation" V1 WHERE (V1."id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) AND V1."id" = (W1."id") AND W1."course_id" = (W0."id")) LIMIT #))))) AND "joanie_course_run"."course_id" = #::uuid) ORDER BY "joanie_course_run"."start" ASC'
- cache|get: parler.core.CourseTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_course" WHERE "joanie_course"."id" = #::uuid LIMIT #'
- db: 'SELECT ... FROM "joanie_course_run" LEFT OUTER JOIN "joanie_product_target_course_relation_course_runs" ON ("joanie_course_run"."id" = "joanie_product_target_course_relation_course_runs"."courserun_id") WHERE (("joanie_product_target_course_relation_course_runs"."producttargetcourserelation_id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) OR "joanie_course_run"."course_id" IN (SELECT W0."id" FROM "joanie_course" W0 INNER JOIN "joanie_product_target_course_relation" W1 ON (W0."id" = W1."course_id") WHERE (W1."product_id" = #::uuid AND NOT (EXISTS(SELECT # AS "a" FROM "joanie_product_target_course_relation" V1 WHERE (V1."id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) AND V1."id" = (W1."id") AND W1."course_id" = (W0."id")) LIMIT #))))) AND "joanie_course_run"."course_id" = #::uuid) ORDER BY "joanie_course_run"."start" ASC'
- cache|get: parler.core.CourseTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_course_run" LEFT OUTER JOIN "joanie_product_target_course_relation_course_runs" ON ("joanie_course_run"."id" = "joanie_product_target_course_relation_course_runs"."courserun_id") WHERE (("joanie_product_target_course_relation_course_runs"."producttargetcourserelation_id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) OR "joanie_course_run"."course_id" IN (SELECT W0."id" FROM "joanie_course" W0 INNER JOIN "joanie_product_target_course_relation" W1 ON (W0."id" = W1."course_id") WHERE (W1."product_id" = #::uuid AND NOT (EXISTS(SELECT # AS "a" FROM "joanie_product_target_course_relation" V1 WHERE (V1."id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) AND V1."id" = (W1."id") AND W1."course_id" = (W0."id")) LIMIT #))))) AND "joanie_course_run"."end" > #::timestamptz)'
- db: 'SELECT ... FROM "joanie_offeringrule" INNER JOIN "joanie_course_product_relation" ON ("joanie_offeringrule"."course_product_relation_id" = "joanie_course_product_relation"."id") WHERE ("joanie_offeringrule"."is_active" AND "joanie_offeringrule"."course_product_relation_id" = #::uuid AND "joanie_offeringrule"."is_active") ORDER BY "joanie_course_product_relation"."created_on" DESC, "joanie_offeringrule"."position" ASC'
OfferingApiTest.test_api_offering_read_detail_with_product_id_anonymous.2:
- db: 'SELECT DISTINCT ... FROM "joanie_course_product_relation" INNER JOIN "joanie_course_product_relation_organizations" ON ("joanie_course_product_relation"."id" = "joanie_course_product_relation_organizations"."courseproductrelation_id") INNER JOIN "joanie_course" ON ("joanie_course_product_relation"."course_id" = "joanie_course"."id") INNER JOIN "joanie_product" ON ("joanie_course_product_relation"."product_id" = "joanie_product"."id") LEFT OUTER JOIN "joanie_certificate_definition" ON ("joanie_product"."certificate_definition_id" = "joanie_certificate_definition"."id") LEFT OUTER JOIN "joanie_contract_definition" ON ("joanie_product"."contract_definition_id" = "joanie_contract_definition"."id") WHERE ("joanie_course_product_relation_organizations"."organization_id" IS NOT NULL AND UPPER("joanie_course"."code"::text) = UPPER(#) AND UPPER("joanie_course"."code"::text) = UPPER(#) AND "joanie_course_product_relation"."product_id" = #::uuid) LIMIT #'
- db: SELECT ... FROM "joanie_organization" INNER JOIN "joanie_course_product_relation_organizations" ON ("joanie_organization"."id" = "joanie_course_product_relation_organizations"."organization_id") WHERE "joanie_course_product_relation_organizations"."courseproductrelation_id" IN (#::uuid) ORDER BY "joanie_organization"."created_on" DESC
- db: SELECT ... FROM "joanie_offeringrule" INNER JOIN "joanie_course_product_relation" ON ("joanie_offeringrule"."course_product_relation_id" = "joanie_course_product_relation"."id") WHERE ("joanie_offeringrule"."is_active" AND "joanie_offeringrule"."course_product_relation_id" IN (#::uuid)) ORDER BY "joanie_course_product_relation"."created_on" DESC, "joanie_offeringrule"."position" ASC
- cache|get: CourseProductRelation-#-#.#-en-us
OfferingApiTest.test_api_offering_read_detail_with_product_id_anonymous.3:
- db: 'SELECT DISTINCT ... FROM "joanie_course_product_relation" INNER JOIN "joanie_course_product_relation_organizations" ON ("joanie_course_product_relation"."id" = "joanie_course_product_relation_organizations"."courseproductrelation_id") INNER JOIN "joanie_course" ON ("joanie_course_product_relation"."course_id" = "joanie_course"."id") INNER JOIN "joanie_product" ON ("joanie_course_product_relation"."product_id" = "joanie_product"."id") LEFT OUTER JOIN "joanie_certificate_definition" ON ("joanie_product"."certificate_definition_id" = "joanie_certificate_definition"."id") LEFT OUTER JOIN "joanie_contract_definition" ON ("joanie_product"."contract_definition_id" = "joanie_contract_definition"."id") WHERE ("joanie_course_product_relation_organizations"."organization_id" IS NOT NULL AND UPPER("joanie_course"."code"::text) = UPPER(#) AND UPPER("joanie_course"."code"::text) = UPPER(#) AND "joanie_course_product_relation"."product_id" = #::uuid) LIMIT #'
- db: SELECT ... FROM "joanie_organization" INNER JOIN "joanie_course_product_relation_organizations" ON ("joanie_organization"."id" = "joanie_course_product_relation_organizations"."organization_id") WHERE "joanie_course_product_relation_organizations"."courseproductrelation_id" IN (#::uuid) ORDER BY "joanie_organization"."created_on" DESC
- db: SELECT ... FROM "joanie_offeringrule" INNER JOIN "joanie_course_product_relation" ON ("joanie_offeringrule"."course_product_relation_id" = "joanie_course_product_relation"."id") WHERE ("joanie_offeringrule"."is_active" AND "joanie_offeringrule"."course_product_relation_id" IN (#::uuid)) ORDER BY "joanie_course_product_relation"."created_on" DESC, "joanie_offeringrule"."position" ASC
- cache|get: CourseProductRelation-#-#.#-en-us
OfferingApiTest.test_api_offering_read_detail_with_product_id_anonymous.4:
- db: 'SELECT DISTINCT ... FROM "joanie_course_product_relation" INNER JOIN "joanie_course_product_relation_organizations" ON ("joanie_course_product_relation"."id" = "joanie_course_product_relation_organizations"."courseproductrelation_id") INNER JOIN "joanie_course" ON ("joanie_course_product_relation"."course_id" = "joanie_course"."id") INNER JOIN "joanie_product" ON ("joanie_course_product_relation"."product_id" = "joanie_product"."id") LEFT OUTER JOIN "joanie_certificate_definition" ON ("joanie_product"."certificate_definition_id" = "joanie_certificate_definition"."id") LEFT OUTER JOIN "joanie_contract_definition" ON ("joanie_product"."contract_definition_id" = "joanie_contract_definition"."id") WHERE ("joanie_course_product_relation_organizations"."organization_id" IS NOT NULL AND UPPER("joanie_course"."code"::text) = UPPER(#) AND UPPER("joanie_course"."code"::text) = UPPER(#) AND "joanie_course_product_relation"."product_id" = #::uuid) LIMIT #'
- db: SELECT ... FROM "joanie_organization" INNER JOIN "joanie_course_product_relation_organizations" ON ("joanie_organization"."id" = "joanie_course_product_relation_organizations"."organization_id") WHERE "joanie_course_product_relation_organizations"."courseproductrelation_id" IN (#::uuid) ORDER BY "joanie_organization"."created_on" DESC
- db: SELECT ... FROM "joanie_offeringrule" INNER JOIN "joanie_course_product_relation" ON ("joanie_offeringrule"."course_product_relation_id" = "joanie_course_product_relation"."id") WHERE ("joanie_offeringrule"."is_active" AND "joanie_offeringrule"."course_product_relation_id" IN (#::uuid)) ORDER BY "joanie_course_product_relation"."created_on" DESC, "joanie_offeringrule"."position" ASC
- cache|get: CourseProductRelation-#-#.#-fr-fr
- cache|get: parler.core.CourseTranslation.#.fr-fr
- db: 'SELECT ... FROM "joanie_course_translation" WHERE ("joanie_course_translation"."master_id" = #::uuid AND "joanie_course_translation"."language_code" = #) LIMIT #'
- cache|set: parler.core.CourseTranslation.#.fr-fr
- cache|get: parler.core.CourseTranslation.#.en-us
- cache|get: parler.core.OrganizationTranslation.#.fr-fr
- db: 'SELECT ... FROM "joanie_organization_translation" WHERE ("joanie_organization_translation"."master_id" = #::uuid AND "joanie_organization_translation"."language_code" = #) LIMIT #'
- cache|set: parler.core.OrganizationTranslation.#.fr-fr
- cache|get: parler.core.OrganizationTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_address" WHERE ("joanie_address"."organization_id" = #::uuid AND "joanie_address"."is_main" AND "joanie_address"."is_reusable") ORDER BY "joanie_address"."created_on" DESC LIMIT #'
- cache|get: parler.core.OrganizationTranslation.#.fr-fr
- db: 'SELECT ... FROM "joanie_organization_translation" WHERE ("joanie_organization_translation"."master_id" = #::uuid AND "joanie_organization_translation"."language_code" = #) LIMIT #'
- cache|set: parler.core.OrganizationTranslation.#.fr-fr
- cache|get: parler.core.OrganizationTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_address" WHERE ("joanie_address"."organization_id" = #::uuid AND "joanie_address"."is_main" AND "joanie_address"."is_reusable") ORDER BY "joanie_address"."created_on" DESC LIMIT #'
- cache|get: parler.core.ProductTranslation.#.fr-fr
- db: 'SELECT ... FROM "joanie_product_translation" WHERE ("joanie_product_translation"."master_id" = #::uuid AND "joanie_product_translation"."language_code" = #) LIMIT #'
- cache|set: parler.core.ProductTranslation.#.fr-fr
- cache|get: parler.core.ProductTranslation.#.en-us
- cache|get: parler.core.CertificateDefinitionTranslation.#.fr-fr
- db: 'SELECT ... FROM "joanie_certificate_definition_translation" WHERE ("joanie_certificate_definition_translation"."master_id" = #::uuid AND "joanie_certificate_definition_translation"."language_code" = #) LIMIT #'
- cache|set: parler.core.CertificateDefinitionTranslation.#.fr-fr
- cache|get: parler.core.CertificateDefinitionTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_course_run" LEFT OUTER JOIN "joanie_product_target_course_relation_course_runs" ON ("joanie_course_run"."id" = "joanie_product_target_course_relation_course_runs"."courserun_id") WHERE ("joanie_product_target_course_relation_course_runs"."producttargetcourserelation_id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) OR "joanie_course_run"."course_id" IN (SELECT W0."id" FROM "joanie_course" W0 INNER JOIN "joanie_product_target_course_relation" W1 ON (W0."id" = W1."course_id") WHERE (W1."product_id" = #::uuid AND NOT (EXISTS(SELECT # AS "a" FROM "joanie_product_target_course_relation" V1 WHERE (V1."id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) AND V1."id" = (W1."id") AND W1."course_id" = (W0."id")) LIMIT #)))))'
- db: 'SELECT ... FROM "joanie_product_target_course_relation" INNER JOIN "joanie_course" ON ("joanie_product_target_course_relation"."course_id" = "joanie_course"."id") WHERE "joanie_product_target_course_relation"."product_id" = #::uuid ORDER BY "joanie_product_target_course_relation"."position" ASC, "joanie_course"."code" ASC'
- db: 'SELECT ... FROM "joanie_course" WHERE "joanie_course"."id" = #::uuid LIMIT #'
- db: 'SELECT ... FROM "joanie_course_run" LEFT OUTER JOIN "joanie_product_target_course_relation_course_runs" ON ("joanie_course_run"."id" = "joanie_product_target_course_relation_course_runs"."courserun_id") WHERE (("joanie_product_target_course_relation_course_runs"."producttargetcourserelation_id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) OR "joanie_course_run"."course_id" IN (SELECT W0."id" FROM "joanie_course" W0 INNER JOIN "joanie_product_target_course_relation" W1 ON (W0."id" = W1."course_id") WHERE (W1."product_id" = #::uuid AND NOT (EXISTS(SELECT # AS "a" FROM "joanie_product_target_course_relation" V1 WHERE (V1."id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) AND V1."id" = (W1."id") AND W1."course_id" = (W0."id")) LIMIT #))))) AND "joanie_course_run"."course_id" = #::uuid) ORDER BY "joanie_course_run"."start" ASC'
- cache|get: parler.core.CourseTranslation.#.fr-fr
- db: 'SELECT ... FROM "joanie_course_translation" WHERE ("joanie_course_translation"."master_id" = #::uuid AND "joanie_course_translation"."language_code" = #) LIMIT #'
- cache|set: parler.core.CourseTranslation.#.fr-fr
- cache|get: parler.core.CourseTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_course" WHERE "joanie_course"."id" = #::uuid LIMIT #'
- db: 'SELECT ... FROM "joanie_course_run" LEFT OUTER JOIN "joanie_product_target_course_relation_course_runs" ON ("joanie_course_run"."id" = "joanie_product_target_course_relation_course_runs"."courserun_id") WHERE (("joanie_product_target_course_relation_course_runs"."producttargetcourserelation_id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) OR "joanie_course_run"."course_id" IN (SELECT W0."id" FROM "joanie_course" W0 INNER JOIN "joanie_product_target_course_relation" W1 ON (W0."id" = W1."course_id") WHERE (W1."product_id" = #::uuid AND NOT (EXISTS(SELECT # AS "a" FROM "joanie_product_target_course_relation" V1 WHERE (V1."id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) AND V1."id" = (W1."id") AND W1."course_id" = (W0."id")) LIMIT #))))) AND "joanie_course_run"."course_id" = #::uuid) ORDER BY "joanie_course_run"."start" ASC'
- cache|get: parler.core.CourseTranslation.#.fr-fr
- db: 'SELECT ... FROM "joanie_course_translation" WHERE ("joanie_course_translation"."master_id" = #::uuid AND "joanie_course_translation"."language_code" = #) LIMIT #'
- cache|set: parler.core.CourseTranslation.#.fr-fr
- cache|get: parler.core.CourseTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_course_run" LEFT OUTER JOIN "joanie_product_target_course_relation_course_runs" ON ("joanie_course_run"."id" = "joanie_product_target_course_relation_course_runs"."courserun_id") WHERE (("joanie_product_target_course_relation_course_runs"."producttargetcourserelation_id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) OR "joanie_course_run"."course_id" IN (SELECT W0."id" FROM "joanie_course" W0 INNER JOIN "joanie_product_target_course_relation" W1 ON (W0."id" = W1."course_id") WHERE (W1."product_id" = #::uuid AND NOT (EXISTS(SELECT # AS "a" FROM "joanie_product_target_course_relation" V1 WHERE (V1."id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) AND V1."id" = (W1."id") AND W1."course_id" = (W0."id")) LIMIT #))))) AND "joanie_course_run"."end" > #::timestamptz)'
- db: 'SELECT ... FROM "joanie_offeringrule" INNER JOIN "joanie_course_product_relation" ON ("joanie_offeringrule"."course_product_relation_id" = "joanie_course_product_relation"."id") WHERE ("joanie_offeringrule"."is_active" AND "joanie_offeringrule"."course_product_relation_id" = #::uuid AND "joanie_offeringrule"."is_active") ORDER BY "joanie_course_product_relation"."created_on" DESC, "joanie_offeringrule"."position" ASC'
- cache|set: CourseProductRelation-#-#.#-fr-fr
OfferingApiTest.test_api_offering_read_detail_with_product_id_anonymous.5:
- db: 'SELECT DISTINCT ... FROM "joanie_course_product_relation" INNER JOIN "joanie_course_product_relation_organizations" ON ("joanie_course_product_relation"."id" = "joanie_course_product_relation_organizations"."courseproductrelation_id") INNER JOIN "joanie_course" ON ("joanie_course_product_relation"."course_id" = "joanie_course"."id") INNER JOIN "joanie_product" ON ("joanie_course_product_relation"."product_id" = "joanie_product"."id") LEFT OUTER JOIN "joanie_certificate_definition" ON ("joanie_product"."certificate_definition_id" = "joanie_certificate_definition"."id") LEFT OUTER JOIN "joanie_contract_definition" ON ("joanie_product"."contract_definition_id" = "joanie_contract_definition"."id") WHERE ("joanie_course_product_relation_organizations"."organization_id" IS NOT NULL AND UPPER("joanie_course"."code"::text) = UPPER(#) AND UPPER("joanie_course"."code"::text) = UPPER(#) AND "joanie_course_product_relation"."product_id" = #::uuid) LIMIT #'
- db: SELECT ... FROM "joanie_organization" INNER JOIN "joanie_course_product_relation_organizations" ON ("joanie_organization"."id" = "joanie_course_product_relation_organizations"."organization_id") WHERE "joanie_course_product_relation_organizations"."courseproductrelation_id" IN (#::uuid) ORDER BY "joanie_organization"."created_on" DESC
- db: SELECT ... FROM "joanie_offeringrule" INNER JOIN "joanie_course_product_relation" ON ("joanie_offeringrule"."course_product_relation_id" = "joanie_course_product_relation"."id") WHERE ("joanie_offeringrule"."is_active" AND "joanie_offeringrule"."course_product_relation_id" IN (#::uuid)) ORDER BY "joanie_course_product_relation"."created_on" DESC, "joanie_offeringrule"."position" ASC
- cache|get: CourseProductRelation-#-#.#-fr-fr
OfferingApiTest.test_api_offering_read_offering_rules:
- db: 'SELECT DISTINCT ... FROM "joanie_course_product_relation" INNER JOIN "joanie_course_product_relation_organizations" ON ("joanie_course_product_relation"."id" = "joanie_course_product_relation_organizations"."courseproductrelation_id") INNER JOIN "joanie_course" ON ("joanie_course_product_relation"."course_id" = "joanie_course"."id") INNER JOIN "joanie_course_access" ON ("joanie_course"."id" = "joanie_course_access"."course_id") INNER JOIN "joanie_user" ON ("joanie_course_access"."user_id" = "joanie_user"."id") INNER JOIN "joanie_product" ON ("joanie_course_product_relation"."product_id" = "joanie_product"."id") LEFT OUTER JOIN "joanie_certificate_definition" ON ("joanie_product"."certificate_definition_id" = "joanie_certificate_definition"."id") LEFT OUTER JOIN "joanie_contract_definition" ON ("joanie_product"."contract_definition_id" = "joanie_contract_definition"."id") WHERE ("joanie_course_product_relation_organizations"."organization_id" IS NOT NULL AND "joanie_user"."username" = # AND "joanie_course_product_relation"."id" = #::uuid) LIMIT #'
- db: SELECT ... FROM "joanie_organization" INNER JOIN "joanie_course_product_relation_organizations" ON ("joanie_organization"."id" = "joanie_course_product_relation_organizations"."organization_id") WHERE "joanie_course_product_relation_organizations"."courseproductrelation_id" IN (#::uuid) ORDER BY "joanie_organization"."created_on" DESC
- db: SELECT ... FROM "joanie_offeringrule" INNER JOIN "joanie_course_product_relation" ON ("joanie_offeringrule"."course_product_relation_id" = "joanie_course_product_relation"."id") WHERE ("joanie_offeringrule"."is_active" AND "joanie_offeringrule"."course_product_relation_id" IN (#::uuid)) ORDER BY "joanie_course_product_relation"."created_on" DESC, "joanie_offeringrule"."position" ASC
- db: 'SELECT ... FROM "easy_thumbnails_source" WHERE ("easy_thumbnails_source"."name" = # AND "easy_thumbnails_source"."storage_hash" = #) LIMIT #'
- db: 'UPDATE "easy_thumbnails_source" SET ... WHERE "easy_thumbnails_source"."id" = #'
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- cache|get: parler.core.CourseTranslation.#.en-us
- db: 'SELECT ... FROM "easy_thumbnails_source" WHERE ("easy_thumbnails_source"."name" = # AND "easy_thumbnails_source"."storage_hash" = #) LIMIT #'
- db: 'UPDATE "easy_thumbnails_source" SET ... WHERE "easy_thumbnails_source"."id" = #'
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- db: 'SELECT ... FROM "easy_thumbnails_thumbnail" WHERE ("easy_thumbnails_thumbnail"."name" = # AND "easy_thumbnails_thumbnail"."source_id" = # AND "easy_thumbnails_thumbnail"."storage_hash" = #) LIMIT #'
- db: SAVEPOINT `#`
- db: INSERT INTO "easy_thumbnails_thumbnail" (...) VALUES (...) RETURNING "easy_thumbnails_thumbnail"."id"
- db: RELEASE SAVEPOINT `#`
- cache|get: parler.core.OrganizationTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_address" WHERE ("joanie_address"."organization_id" = #::uuid AND "joanie_address"."is_main" AND "joanie_address"."is_reusable") ORDER BY "joanie_address"."created_on" DESC LIMIT #'
- cache|get: parler.core.ProductTranslation.#.en-us
- cache|get: parler.core.CertificateDefinitionTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_course_run" LEFT OUTER JOIN "joanie_product_target_course_relation_course_runs" ON ("joanie_course_run"."id" = "joanie_product_target_course_relation_course_runs"."courserun_id") WHERE ("joanie_product_target_course_relation_course_runs"."producttargetcourserelation_id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) OR "joanie_course_run"."course_id" IN (SELECT W0."id" FROM "joanie_course" W0 INNER JOIN "joanie_product_target_course_relation" W1 ON (W0."id" = W1."course_id") WHERE (W1."product_id" = #::uuid AND NOT (EXISTS(SELECT # AS "a" FROM "joanie_product_target_course_relation" V1 WHERE (V1."id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) AND V1."id" = (W1."id") AND W1."course_id" = (W0."id")) LIMIT #)))))'
- db: 'SELECT ... FROM "joanie_product_target_course_relation" INNER JOIN "joanie_course" ON ("joanie_product_target_course_relation"."course_id" = "joanie_course"."id") WHERE "joanie_product_target_course_relation"."product_id" = #::uuid ORDER BY "joanie_product_target_course_relation"."position" ASC, "joanie_course"."code" ASC'
- db: 'SELECT ... FROM "joanie_course_run" LEFT OUTER JOIN "joanie_product_target_course_relation_course_runs" ON ("joanie_course_run"."id" = "joanie_product_target_course_relation_course_runs"."courserun_id") WHERE (("joanie_product_target_course_relation_course_runs"."producttargetcourserelation_id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) OR "joanie_course_run"."course_id" IN (SELECT W0."id" FROM "joanie_course" W0 INNER JOIN "joanie_product_target_course_relation" W1 ON (W0."id" = W1."course_id") WHERE (W1."product_id" = #::uuid AND NOT (EXISTS(SELECT # AS "a" FROM "joanie_product_target_course_relation" V1 WHERE (V1."id" IN (SELECT U0."id" FROM "joanie_product_target_course_relation" U0 INNER JOIN "joanie_product_target_course_relation_course_runs" U2 ON (U0."id" = U2."producttargetcourserelation_id") WHERE (U0."product_id" = #::uuid AND U2."courserun_id" IS NOT NULL)) AND V1."id" = (W1."id") AND W1."course_id" = (W0."id")) LIMIT #))))) AND "joanie_course_run"."end" > #::timestamptz)'
- db: 'SELECT ... FROM "joanie_offeringrule" INNER JOIN "joanie_course_product_relation" ON ("joanie_offeringrule"."course_product_relation_id" = "joanie_course_product_relation"."id") WHERE ("joanie_offeringrule"."is_active" AND "joanie_offeringrule"."course_product_relation_id" = #::uuid AND "joanie_offeringrule"."is_active") ORDER BY "joanie_course_product_relation"."created_on" DESC, "joanie_offeringrule"."position" ASC'
- db: 'SELECT COUNT(*) AS "__count" FROM "joanie_order" INNER JOIN "joanie_order_offering_rules" ON ("joanie_order"."id" = "joanie_order_offering_rules"."order_id") LEFT OUTER JOIN "joanie_enrollment" ON ("joanie_order"."enrollment_id" = "joanie_enrollment"."id") LEFT OUTER JOIN "joanie_course_run" ON ("joanie_enrollment"."course_run_id" = "joanie_course_run"."id") WHERE ("joanie_order_offering_rules"."offeringrule_id" = #::uuid AND ("joanie_order"."course_id" = #::uuid OR "joanie_course_run"."course_id" = #::uuid) AND "joanie_order"."product_id" = #::uuid AND "joanie_order"."state" IN (...))'
- db: 'SELECT COUNT(*) AS "__count" FROM "joanie_order" INNER JOIN "joanie_order_offering_rules" ON ("joanie_order"."id" = "joanie_order_offering_rules"."order_id") WHERE ("joanie_order_offering_rules"."offeringrule_id" = #::uuid AND "joanie_order"."course_id" = #::uuid AND "joanie_order"."product_id" = #::uuid AND "joanie_order"."state" = #)'
- cache|get: parler.core.OfferingRuleTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_offeringrule_translation" WHERE ("joanie_offeringrule_translation"."master_id" = #::uuid AND "joanie_offeringrule_translation"."language_code" = #) LIMIT #'
- cache|set: parler.core.OfferingRuleTranslation.#.en-us
- db: 'SELECT ... FROM "joanie_discount" WHERE "joanie_discount"."id" = #::uuid LIMIT #'
- db: 'SELECT COUNT(*) AS "__count" FROM "joanie_order" INNER JOIN "joanie_order_offering_rules" ON ("joanie_order"."id" = "joanie_order_offering_rules"."order_id") LEFT OUTER JOIN "joanie_enrollment" ON ("joanie_order"."enrollment_id" = "joanie_enrollment"."id") LEFT OUTER JOIN "joanie_course_run" ON ("joanie_enrollment"."course_run_id" = "joanie_course_run"."id") WHERE ("joanie_order_offering_rules"."offeringrule_id" = #::uuid AND ("joanie_order"."course_id" = #::uuid OR "joanie_course_run"."course_id" = #::uuid) AND "joanie_order"."product_id" = #::uuid AND "joanie_order"."state" IN (...))'
- db: 'SELECT COUNT(*) AS "__count" FROM "joanie_order" INNER JOIN "joanie_order_offering_rules" ON ("joanie_order"."id" = "joanie_order_offering_rules"."order_id") WHERE ("joanie_order_offering_rules"."offeringrule_id" = #::uuid AND "joanie_order"."course_id" = #::uuid AND "joanie_order"."product_id" = #::uuid AND "joanie_order"."state" = #)'
- db: 'SELECT COUNT(*) AS "__count" FROM "joanie_order" INNER JOIN "joanie_order_offering_rules" ON ("joanie_order"."id" = "joanie_order_offering_rules"."order_id") LEFT OUTER JOIN "joanie_enrollment" ON ("joanie_order"."enrollment_id" = "joanie_enrollment"."id") LEFT OUTER JOIN "joanie_course_run" ON ("joanie_enrollment"."course_run_id" = "joanie_course_run"."id") WHERE ("joanie_order_offering_rules"."offeringrule_id" = #::uuid AND ("joanie_order"."course_id" = #::uuid OR "joanie_course_run"."course_id" = #::uuid) AND "joanie_order"."product_id" = #::uuid AND "joanie_order"."state" IN (...))'
- db: 'SELECT COUNT(*) AS "__count" FROM "joanie_order" INNER JOIN "joanie_order_offering_rules" ON ("joanie_order"."id" = "joanie_order_offering_rules"."order_id") WHERE ("joanie_order_offering_rules"."offeringrule_id" = #::uuid AND "joanie_order"."course_id" = #::uuid AND "joanie_order"."product_id" = #::uuid AND "joanie_order"."state" = #)'
- db: 'SELECT COUNT(*) AS "__count" FROM "joanie_order" INNER JOIN "joanie_order_offering_rules" ON ("joanie_order"."id" = "joanie_order_offering_rules"."order_id") LEFT OUTER JOIN "joanie_enrollment" ON ("joanie_order"."enrollment_id" = "joanie_enrollment"."id") LEFT OUTER JOIN "joanie_course_run" ON ("joanie_enrollment"."course_run_id" = "joanie_course_run"."id") WHERE ("joanie_order_offering_rules"."offeringrule_id" = #::uuid AND ("joanie_order"."course_id" = #::uuid OR "joanie_course_run"."course_id" = #::uuid) AND "joanie_order"."product_id" = #::uuid AND "joanie_order"."state" IN (...))'
- db: 'SELECT COUNT(*) AS "__count" FROM "joanie_order" INNER JOIN "joanie_order_offering_rules" ON ("joanie_order"."id" = "joanie_order_offering_rules"."order_id") WHERE ("joanie_order_offering_rules"."offeringrule_id" = #::uuid AND "joanie_order"."course_id" = #::uuid AND "joanie_order"."product_id" = #::uuid AND "joanie_order"."state" = #)'
OfferingApiTest.test_api_offering_read_offering_rules.2:
- db: 'SELECT DISTINCT ... FROM "joanie_course_product_relation" INNER JOIN "joanie_course_product_relation_organizations" ON ("joanie_course_product_relation"."id" = "joanie_course_product_relation_organizations"."courseproductrelation_id") INNER JOIN "joanie_course" ON ("joanie_course_product_relation"."course_id" = "joanie_course"."id") INNER JOIN "joanie_course_access" ON ("joanie_course"."id" = "joanie_course_access"."course_id") INNER JOIN "joanie_user" ON ("joanie_course_access"."user_id" = "joanie_user"."id") INNER JOIN "joanie_product" ON ("joanie_course_product_relation"."product_id" = "joanie_product"."id") LEFT OUTER JOIN "joanie_certificate_definition" ON ("joanie_product"."certificate_definition_id" = "joanie_certificate_definition"."id") LEFT OUTER JOIN "joanie_contract_definition" ON ("joanie_product"."contract_definition_id" = "joanie_contract_definition"."id") WHERE ("joanie_course_product_relation_organizations"."organization_id" IS NOT NULL AND "joanie_user"."username" = # AND "joanie_course_product_relation"."id" = #::uuid) LIMIT #'
- db: SELECT ... FROM "joanie_organization" INNER JOIN "joanie_course_product_relation_organizations" ON ("joanie_organization"."id" = "joanie_course_product_relation_organizations"."organization_id") WHERE "joanie_course_product_relation_organizations"."courseproductrelation_id" IN (#::uuid) ORDER BY "joanie_organization"."created_on" DESC
- db: SELECT ... FROM "joanie_offeringrule" INNER JOIN "joanie_course_product_relation" ON ("joanie_offeringrule"."course_product_relation_id" = "joanie_course_product_relation"."id") WHERE ("joanie_offeringrule"."is_active" AND "joanie_offeringrule"."course_product_relation_id" IN (#::uuid)) ORDER BY "joanie_course_product_relation"."created_on" DESC, "joanie_offeringrule"."position" ASC
- cache|get: CourseProductRelation-#-#.#-en-us
OfferingApiTest.test_api_offering_read_offering_rules_no_cache:
- db: 'SELECT DISTINCT ... FROM "joanie_course_product_relation" INNER JOIN "joanie_course_product_relation_organizations" ON ("joanie_course_product_relation"."id" = "joanie_course_product_relation_organizations"."courseproductrelation_id") INNER JOIN "joanie_course" ON ("joanie_course_product_relation"."course_id" = "joanie_course"."id") INNER JOIN "joanie_course_access" ON ("joanie_course"."id" = "joanie_course_access"."course_id") INNER JOIN "joanie_user" ON ("joanie_course_access"."user_id" = "joanie_user"."id") INNER JOIN "joanie_product" ON ("joanie_course_product_relation"."product_id" = "joanie_product"."id") LEFT OUTER JOIN "joanie_certificate_definition" ON ("joanie_product"."certificate_definition_id" = "joanie_certificate_definition"."id") LEFT OUTER JOIN "joanie_contract_definition" ON ("joanie_product"."contract_definition_id" = "joanie_contract_definition"."id") WHERE ("joanie_course_product_relation_organizations"."organization_id" IS NOT NULL AND "joanie_user"."username" = # AND "joanie_course_product_relation"."id" = #::uuid) LIMIT #'
- db: SELECT ... FROM "joanie_organization" INNER JOIN "joanie_course_product_relation_organizations" ON ("joanie_organization"."id" = "joanie_course_product_relation_organizations"."organization_id") WHERE "joanie_course_product_relation_organizations"."courseproductrelation_id" IN (#::uuid) ORDER BY "joanie_organization"."created_on" DESC
- db: SELECT ... FROM "joanie_offeringrule" INNER JOIN "joanie_course_product_relation" ON ("joanie_offeringrule"."course_product_relation_id" = "joanie_course_product_relation"."id") WHERE ("joanie_offeringrule"."is_active" AND "joanie_offeringrule"."course_product_relation_id" IN (#::uuid)) ORDER BY "joanie_course_product_relation"."created_on" DESC, "joanie_offeringrule"."position" ASC
- cache|get: CourseProductRelation-#-#.#-en-us
